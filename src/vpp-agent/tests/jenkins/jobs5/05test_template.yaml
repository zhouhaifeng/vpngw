- job-template:
    description: |-
      <!-- Managed by Jenkins Job Builder -->
      {path_to_test} ## {HOWTOBUILD_INCLTAGPRESENT}
      Note 1 - Source Code Management
      - no setup inside of this job because this is a prerequisite - prepared folder with ligato/vpp agent project
      this is in order to save the time needed for project setup in case that every suite present in unique file is run separately
      - THE CONSEQUENCE: the path to the test file is hardcoded (generated by jenkins job builder)
      Note 2 - other prerequisites
      - that docker images are built
      - nodes are properly setup (python, robotframework, jjb, docker, robot account, ...)
      - file with variables (VARIABLES_FILE) prepared describing current topology in folder tests/robot/variables
      Note 3
      -prerequisites and variables values are going to be changed from pipelines which fire up the separate jenkins jobs
      -however this job can be fired up also manually provided that prerequisites are satisfied
      Note 4
      - prerequisites is that Jenkins master is labeled PrepareLigatoTestConfig
      TODO:
      - running directly on ARM64 nodes
      generated on {date_of_jjb_generation}
      .
    builders:
      - shell: |-
          # defaults:
          # --loglevel TRACE:INFO
          # -v VARIABLES:arm64_local  # it refers to the file tests/robot/variables/arm64_local_variables.robot
          # -v AGENT_VPP_IMAGE_NAME:ligato/vpp-agent-arm64:dev  # to override the settings in variable file
          # -v DOCKER_HOST_IP: 147.75.72.194 # to override the settings in variable file
          # --include ExpectedFailure  # default for manual execution
          if [ "${{HOWTOBUILD}}" = "--exclude ExpectedFailure" ]; then
            # if tag ExpectedFailure is present in robot test then this jenkins job will be commented in pipeline
            # if tag ExpectedFailure is present in robot test the placeholder HOWTOBUILD_TAGPRESENT will be replaced by --include ExpectedFailure to indicate that robot test is tagged otherwise placeholder will by replaced by spaces
            # if pipeline is executed with parameter --exclude ExpectedFailure it should be replaced correctly here
            pybot --loglevel ${{LOGLEVEL}} -v AGENT_VPP_IMAGE_NAME:${{IMAGE_NAME}} -v AGENT_IMAGE_NAME:${{IMAGE_NAME}} -v DOCKER_HOST_IP:${{DOCKER_HOST_IP}} -v VARIABLES:${{VARIABLES_FILE}} {HOWTOBUILD_EXCLTAGPRESENT}  {path_to_test}
          else
            #pybot --nostatusrc --xunit xunit.xml --xunitskipnoncritical --loglevel TRACE:INFO --consolecolors on -v VARIABLES:{local_variables_file} --exclude ExpectedFailure {path_to_test}
            pybot --loglevel ${{LOGLEVEL}} -v AGENT_VPP_IMAGE_NAME:${{IMAGE_NAME}} -v AGENT_IMAGE_NAME:${{IMAGE_NAME}} -v DOCKER_HOST_IP:${{DOCKER_HOST_IP}} -v VARIABLES:${{VARIABLES_FILE}} {HOWTOBUILD_INCLTAGPRESENT}  {path_to_test}
          fi
          #20190227 --nostatusrc will indicate  the test always PASS which is not desirable
    name: '05{inode_of_folder}_{name_of_test}_job'
    node: PrepareLigatoTestConfig
    parameters:
      - choice:
          choices:
            - --include ExpectedFailure
            - --exclude ExpectedFailure
          description: |-
            tests with tag ExpectedFailure
            manual execution - default the test run
            execution from pipeline - both
          name: HOWTOBUILD
      - string:
          default: TRACE:INFO
          description: ''
          name: LOGLEVEL
          trim: 'true'
      - string:
          default: arm64_local
          description: 'ARM64 testing: contivvpp'
          name: VARIABLES_FILE
          trim: 'true'
      - string:
          default: 147.75.72.194
          description: 'to override the settings in VARIABLES_FILE'
          name: DOCKER_HOST_IP
          trim: 'true'
      - string:
          default: ligato/vpp-agent-arm64:dev
          description: 'to override the settings in VARIABLES_FILE'
          name: IMAGE_NAME
          trim: 'true'
    project-type: freestyle
    publishers:
      - archive:
          allow-empty: false
          artifacts: results/**/*
          case-sensitive: true
          default-excludes: true
          fingerprint: false
          only-if-success: false
      - raw:
          xml: |
            <hudson.plugins.robot.RobotPublisher plugin="robot@1.6.4">
            <outputPath>./</outputPath>
            <reportFileName>report.html</reportFileName>
            <logFileName>log.html</logFileName>
            <outputFileName>output.xml</outputFileName>
            <disableArchiveOutput>false</disableArchiveOutput>
            <passThreshold>0.0</passThreshold>
            <unstableThreshold>0.0</unstableThreshold>
            <otherFiles>
            <string />
            </otherFiles>
            <enableCache>true</enableCache>
            <onlyCritical>true</onlyCritical>
            </hudson.plugins.robot.RobotPublisher>
    triggers: []
    wrappers:
      - timeout:
          timeout: 280
          type: absolute
          write-description: Timed out!
      - timestamps
